@page "/favorites"
@using QuotelyAPP.Models
@using QuotelyAPP.Services
@inject FavoritesService FavoritesService

<h2>Favorites</h2>
<p>All your favorites in one place</p>

@if (isLoading)
{
    <p>Loading favorites...</p>
}
else if (favorites == null || !favorites.Any())
{
    <p>No favorites yet? Start adding quotes you like!</p>
}
else
{
    @foreach (var quote in favorites)
    {
        <div class="quote-card" style="position:relative; padding-bottom:50px;">
            <blockquote>"@quote.content"</blockquote>
            <p class="author">— @quote.author</p>
            
            @if (quote.tags != null && quote.tags.Any())
            {
                <div class="tags">
                    @foreach (var tag in quote.tags)
                    {
                        <span>@tag</span>
                    }
                </div>
            }
            
            <button style="position:absolute; bottom:15px; right:15px; background:none; border:none; cursor:pointer; font-size:24px; padding:5px;" @onclick="() => RemoveFavorite(quote)">
                <span style="color:red;">♥</span>
            </button>
        </div>
    }
}

@code {
    List<Quote>? favorites;
    bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadFavorites();
    }

    private async Task LoadFavorites()
    {
        isLoading = true;
        favorites = await FavoritesService.GetFavoritesAsync();
        isLoading = false;
        StateHasChanged();
    }

    private async Task RemoveFavorite(Quote quote)
    {
        await FavoritesService.RemoveFavoriteAsync(quote);
        await LoadFavorites();
    }
}
